<div class="row justify-content-center">
    <div class="col-md-10">
        <h1 class="mb-4"><%= title %></h1>
        
        <% if (errors && errors.length > 0) { %>
            <div class="alert alert-danger">
                <ul class="mb-0">
                    <% errors.forEach(error => { %>
                        <li><%= error.msg || error %></li>
                    <% }) %>
                </ul>
            </div>
        <% } %>
        
        <!-- Form action for update - AJOUT DE L'ID updateForm -->
        <form action="/inv/update" method="post" class="needs-validation" novalidate id="updateForm">
            
            <!-- Hidden field for vehicle ID -->
            <input type="hidden" name="inv_id" value="<%= inv_id %>">
            
            <div class="mb-3">
                <label for="classification_id" class="form-label">Classification</label>
                <%- classificationSelect %>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="inv_make" class="form-label">Make *</label>
                    <input type="text" class="form-control" id="inv_make" name="inv_make" 
                           value="<%= inv_make || '' %>" required>
                    <div class="invalid-feedback">
                        Please enter the vehicle make.
                    </div>
                </div>
                
                <div class="col-md-6 mb-3">
                    <label for="inv_model" class="form-label">Model *</label>
                    <input type="text" class="form-control" id="inv_model" name="inv_model" 
                           value="<%= inv_model || '' %>" required>
                    <div class="invalid-feedback">
                        Please enter the vehicle model.
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="inv_year" class="form-label">Year *</label>
                    <input type="number" class="form-control" id="inv_year" name="inv_year" 
                           value="<%= inv_year || '' %>" min="1900" max="<%= new Date().getFullYear() + 1 %>" required>
                    <div class="invalid-feedback">
                        Please enter a valid year.
                    </div>
                </div>
                
                <div class="col-md-6 mb-3">
                    <label for="inv_price" class="form-label">Price *</label>
                    <div class="input-group">
                        <span class="input-group-text">$</span>
                        <input type="number" class="form-control" id="inv_price" name="inv_price" 
                               value="<%= inv_price || '' %>" min="0" step="0.01" required>
                    </div>
                    <div class="invalid-feedback">
                        Please enter a valid price.
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="inv_miles" class="form-label">Miles *</label>
                    <div class="input-group">
                        <input type="number" class="form-control" id="inv_miles" name="inv_miles" 
                               value="<%= inv_miles || '' %>" min="0" required>
                        <span class="input-group-text">miles</span>
                    </div>
                    <div class="invalid-feedback">
                        Please enter the mileage.
                    </div>
                </div>
                
                <div class="col-md-6 mb-3">
                    <label for="inv_color" class="form-label">Color *</label>
                    <input type="text" class="form-control" id="inv_color" name="inv_color" 
                           value="<%= inv_color || '' %>" required>
                    <div class="invalid-feedback">
                        Please enter the color.
                    </div>
                </div>
            </div>
            
            <div class="mb-3">
                <label for="inv_description" class="form-label">Description *</label>
                <textarea class="form-control" id="inv_description" name="inv_description" 
                          rows="4" required><%= inv_description || '' %></textarea>
                <div class="invalid-feedback">
                    Please enter a description.
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="inv_image" class="form-label">Image URL</label>
                    <input type="text" class="form-control" id="inv_image" name="inv_image" 
                           value="<%= inv_image || '' %>" placeholder="/images/vehicles/no-image.jpg">
                    <div class="form-text">
                        Enter the path to the main image (e.g., /images/vehicles/vehicle-image.jpg)
                    </div>
                </div>
                
                <div class="col-md-6 mb-3">
                    <label for="inv_thumbnail" class="form-label">Thumbnail URL</label>
                    <input type="text" class="form-control" id="inv_thumbnail" name="inv_thumbnail" 
                           value="<%= inv_thumbnail || '' %>" placeholder="/images/vehicles/no-image-tn.jpg">
                    <div class="form-text">
                        Enter the path to the thumbnail image
                    </div>
                </div>
            </div>
            
            <div class="d-flex justify-content-between mt-4">
                <a href="/inv/" class="btn btn-secondary">Cancel</a>
                
                <!-- Submit button for update - AJOUT DE L'ATTRIBUT DISABLED -->
                <button type="submit" class="btn btn-primary" disabled>Update Vehicle</button>
            </div>
        </form>
    </div>
</div>

<!-- Bootstrap Validation Script -->
<script>
(function () {
    'use strict'
    
    // Fetch all the forms we want to apply custom Bootstrap validation styles to
    var forms = document.querySelectorAll('.needs-validation')
    
    // Loop over them and prevent submission
    Array.prototype.slice.call(forms)
        .forEach(function (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault()
                    event.stopPropagation()
                }
                
                form.classList.add('was-validated')
            }, false)
        })
})()

// Form submission loading state
document.querySelector('form').addEventListener('submit', function(e) {
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.classList.add('loading');
    submitBtn.innerHTML = 'Updating...';
    
    // Add slight delay to show loading state
    setTimeout(() => {
        submitBtn.innerHTML = 'Update Vehicle';
        submitBtn.classList.remove('loading');
        submitBtn.disabled = false;
    }, 2000);
});

// Auto-save draft (optional)
let autoSaveTimer;
const form = document.querySelector('form');
const formData = {};

form.addEventListener('input', function(e) {
    clearTimeout(autoSaveTimer);
    autoSaveTimer = setTimeout(() => {
        // Save form data to localStorage
        Array.from(form.elements).forEach(element => {
            if (element.name) {
                formData[element.name] = element.value;
            }
        });
        localStorage.setItem('inventoryDraft', JSON.stringify(formData));
        console.log('Draft saved');
    }, 1000);
});

// Load draft on page load (optional)
window.addEventListener('load', function() {
    const savedDraft = localStorage.getItem('inventoryDraft');
    if (savedDraft) {
        const draft = JSON.parse(savedDraft);
        // Optionally load draft data
    }
});
</script>


<script src="/js/inv-update.js"></script>